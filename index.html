<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Node.js + MySQL Example</title>
</head>
<body>
  <h2>Register User</h2>

  <form id="userForm">
    <input type="text" id="name" placeholder="Enter name" required /><br /><br />
    <input type="email" id="email" placeholder="Enter email" required /><br /><br />
    <button type="submit">Submit</button>
  </form>

  <p id="message"></p>

  <h3>All Users</h3>
  <ul id="userList"></ul>

  <script>
    const form = document.getElementById('userForm');
    const message = document.getElementById('message');
    const userList = document.getElementById('userList');

    // ✅ Function to load all users from backend
    async function loadUsers() {
      try {
        const res = await fetch('http://localhost:5000/api/users');
        const users = await res.json();

        userList.innerHTML = '';
        users.forEach(u => {
          const li = document.createElement('li');
          li.textContent = `${u.name} (${u.email})`;
          userList.appendChild(li);
        });
      } catch (err) {
        console.error('Error loading users:', err);
      }
    }

    // ✅ Submit form handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();

      if (!name || !email) {
        message.textContent = 'Please fill in both fields!';
        return;
      }

      try {
        const res = await fetch('http://localhost:5000/api/users', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email })
        });

        const data = await res.json();
        message.textContent = data.message;
        form.reset();
        loadUsers();
      } catch (err) {
        console.error('Error saving user:', err);
        message.textContent = 'Failed to save user.';
      }
    });

    // Load users on page load
    loadUsers();
  </script>
</body>
</html>
